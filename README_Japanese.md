# DeepLabCut-Ultrasound 
**DLCを用いた超音波舌輪郭抽出モデルの説明**

 **モデルの概要**
 
 このモデルは，超音波動画（舌の動きを映した映像）から舌の輪郭を自動で抽出するツールだ．以下がポイント：

1. **何ができる？**
   - 超音波動画から舌の輪郭を抽出し，輪郭上のポイント（座標）をデータとして保存する．
   - データはCSVファイル（表形式のデータファイル）で出力される．
   - 2つのCSVファイルが作られるが，**名前に「filtered」がつくファイル**を分析に使う．
   - この輪郭データを使えば，異なる音を発する時の舌の動きを1つのグラフに重ねて比較できる．

2. **結果の確認方法**
   - モデルが正しく輪郭を抽出したかは，**輪郭線が描かれた動画**を見てチェックする．
   - 動画で輪郭が舌の形に沿っていれば，CSVデータの座標も信頼できる．

 **モデルの学習データ**
 
このモデルは以下のようなデータで作られている：
- **データ量**：4,821フレーム．
- **データの種類**：
  - 2種類の超音波装置（GE Healthcareとトリプルエー）を用いる．
  - アジア系と欧米系の話者の舌の動きの動画を含む．
- **学習に使ったパソコン**：
  - MSIのノートPC（GPU：NVIDIA GeForce RTX 3060）で約10時間かかった．
  - もっと高性能なGPUなら学習がもっと速くなる．
- **学習回数**：103万回（モデルがデータを繰り返し学習した回数）．

 **研究で使う場合**
 
論文や研究でこのモデルを使うなら，以下を引用する：
> J.Sun, T.Kitamura, and R.Hayashi, "Extraction of Speech Organ Contours from Ultrasound and real-time MRI Data using DeepLabCut", _Acoustical Science and Technology_,1-7(2025).  
> https://doi.org/10.1250/ast.e24.128

 **対応するパソコン**
- **Windows**と**Mac**で使える．
- **GPU（GPUとは「Graphics Processing Unit」の略称で，パソコンで処理した画像などを画面へ描写するために使われる画像処理装置のパーツのこと）**：
  - なくても動くが，GPUがあると処理が速い．
  - GPUがあれば，動画の処理がスムーズに進む．

 **準備：必要なソフトウェアのインストール**
 
モデルを使う前に，以下のソフトをパソコンにインストールする：

1. **Miniconda**  
   - Pythonを簡単に管理するツール．
   - インストール：https://docs.anaconda.com/miniconda/
   - サイトからダウンロードし，画面の指示に従ってインストールする．

2. **Nvidiaドライバー**（GPUを使う場合のみ）
   - GPUを使うなら，Nvidiaのドライバーをインストールする．
   - インストール：https://www.nvidia.com/Download/index.aspx?lang=en-us
   - 自分のGPUに合うドライバーを選ぶ．

3. **CUDA Toolkit**（GPUを使う場合のみ）
   - GPUで高速処理するためのツール．
   - インストール：https://developer.nvidia.com/cuda-downloads?target_os=Windows&target_arch=x86_64&target_version=11&target_type=exe_local
   - Windowsならバージョン11を選んでインストールする．

※ GPUがない場合は，MinicondaだけでOK！

 **処理速度の違い**
- **GPUあり**（例：NVIDIA GeForce RTX 3060）：
  - 1秒に200フレーム以上処理できる（かなり速い！）．
  - 一本や複数の動画もスムーズに処理できる．
  - 短い動画（例：1秒）も長い動画（例：1時間）も処理できる．
- **GPUなし（CPUのみ）**：
  - 1秒に10～20フレーム程度（少し遅い）．
  - 短い動画なら十分使える．

 **対応する動画のサイズ**
このモデルは以下のサイズの超音波動画専用：
- **幅320ピクセル × 高さ240ピクセル**
- このサイズでないと，正確に輪郭を抽出できないので注意！

 **舌の輪郭の抽出方法**
- 舌の輪郭を抽出するため，**11個のポイント**（点）を使う．
- これらの点は，舌の形を正確に捉えられるよう，舌の輪郭に沿って配置される．
- **ポイント：等間隔に配置しない！**
  - 等間隔だと，正確な形を捉えるのに30点以上必要になる．
  - 点が多いと学習データの作成や，学習に時間がかかる．
  - 11点で効率的かつ正確に舌の形を還元できるように工夫されている．

 **モデルの使い方：ステップごとの説明**
超音波動画から舌の輪郭を抽出する手順を説明する！

# **1. DeepLabCutを起動する**
- **Windows**：
  1. 「Anaconda Prompt (miniconda3)」を検索して開く．
  2. 以下のコマンドを順に入力：
     ```
     conda activate deeplabcut
     python -m deeplabcut
     ```
- **Mac**：
  1. 「ターミナル」を開く．
  2. 上と同じコマンドを入力．

これで，DeepLabCutの操作画面（ウィンドウ）が開く．

# **2. プロジェクトを読み込む**
1. 操作画面が開いたら，「Load Project」ボタンをクリック．
2. DLCモデルのフォルダにある「**config.yaml**」ファイルを選ぶ．
   - このファイルは，モデルの設定が書かれた重要なファイル．

# **3. 動画を解析する（輪郭を抽出）**
1. 操作画面で「Analyze videos」ボタンをクリック．
2. 「Select videos」をクリックし，解析したい動画を選ぶ．
   - 対応形式：MP4，AVI，MKV，MOV．
   - **注意**：動画内で**舌先が右側，舌根が左側**になるようにする．
3. 以下のチェックボックスにチェックを入れる：
   - ✅ Save result(s) as csv（結果をCSVで保存）
   - ✅ Filter predictions（予測を滑らかにする）
   - ✅ Plot trajectories（舌の動きを描く）
4. 右下の「Analyze videos」ボタンをクリックして解析を始める．

# **4. 輪郭線付き動画を作る**
1. 操作画面で「Create videos」ボタンをクリック．
2. 以下のチェックボックスにチェック：
   - ✅ Plot all bodyparts（すべてのポイントを表示）
   - ✅ Draw skeleton（ポイントをつなぐ線を描く）
   - ✅ Use filtered data（滑らかなデータを使う）
   - ✅ Plot trajectories（舌の動きを描く）
3. 右下の「Create videos」ボタンをクリックして，輪郭線付き動画を保存する．

# **5. 結果を確認する**
- 保存された**輪郭線付き動画**を見て，舌の輪郭が正しく抽出されているか確認する．
- 輪郭が正しければ，CSVファイル（「filtered」で終わるもの）の座標データを使って分析できる．

 **まとめ**
- このモデルは，超音波動画から舌の輪郭を簡単に抽出できる便利なツール．
- WindowsやMacで使え，GPUがあれば処理が速い．
- 動画サイズ（320×240ピクセル）と舌の向き（舌先が右，舌根が左）に注意．
- 結果は輪郭線付き動画で確認し，CSVデータで分析できる．

